@using MovieTracker.Domain.Entities

<article class="modal fade show d-block app-modal" role="dialog" aria-labelledby="movieModalLabel" @onclick="OnClose" aria-modal="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" @onclick:stopPropagation="true">
        <header class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title h5" id="movieModalLabel">@Movie.Title</h2>
                <button type="button" class="btn-close" aria-label="Close" @onclick="OnClose"></button>
            </div>
            
            <section class="modal-body">
                <div class="row g-4">
                    <!-- Poster -->
                    <div class="col-md-4">
                        <img src="@(Movie.PosterPath ?? "/images/no-poster.png")" 
                             alt="@Movie.Title poster"
                             class="img-fluid rounded" />
                    </div>
                    
                    <!-- Details -->
                    <aside class="col-md-8">
                        @if (!string.IsNullOrEmpty(Movie.Director))
                        {
                            <dl class="mb-3">
                                <dt class="fw-semibold">Director:</dt>
                                <dd>@Movie.Director</dd>
                            </dl>
                        }

                        @if (Movie.Actors != null && Movie.Actors.Any())
                        {
                            <dl class="mb-3">
                                <dt class="fw-semibold">Cast:</dt>
                                <dd>@string.Join(", ", Movie.Actors)</dd>
                            </dl>
                        }

                        @if (!string.IsNullOrEmpty(Movie.Genres))
                        {
                            <dl class="mb-3">
                                <dt class="fw-semibold">Genres:</dt>
                                <dd>@Movie.Genres</dd>
                            </dl>
                        }

                        @if (Movie.Runtime.HasValue)
                        {
                            <dl class="mb-3">
                                <dt class="fw-semibold">Runtime:</dt>
                                <dd>@Movie.Runtime minutes</dd>
                            </dl>
                        }

                        @if (Movie.ReleaseDate.HasValue)
                        {
                            <dl class="mb-3">
                                <dt class="fw-semibold">Release Date:</dt>
                                <dd>@Movie.ReleaseDate.Value.ToString("MMM dd, yyyy")</dd>
                            </dl>
                        }

                        @if (Movie.Rating.HasValue)
                        {
                            <dl class="mb-3">
                                <dt class="fw-semibold">TMDB Rating:</dt>
                                <dd>⭐ @Movie.Rating.Value.ToString("0.0")/10</dd>
                            </dl>
                        }

                        <dl class="mb-3">
                            <dt class="fw-semibold">Watched:</dt>
                            <dd>@Movie.WatchedDate.ToString("MMM dd, yyyy")</dd>
                        </dl>
                    </aside>
                </div>

                <!-- Overview -->
                @if (!string.IsNullOrEmpty(Movie.Overview))
                {
                    <article class="mt-4">
                        <h3 class="h6 fw-semibold mb-2">Overview</h3>
                        <p class="text-muted">@Movie.Overview</p>
                    </article>
                }

                <!-- Your Review -->
                @if (Movie.Review != null)
                {
                    <article class="mt-4 p-3 bg-light border rounded">
                        <h3 class="h6 fw-semibold mb-2">Your Review</h3>
                        @if (Movie.Review.UserRating.HasValue)
                        {
                            <p class="mb-2"><strong>Rating:</strong> ⭐ @Movie.Review.UserRating/10</p>
                        }
                        @if (!string.IsNullOrEmpty(Movie.Review.Comment))
                        {
                            <p class="mb-0 fst-italic">"@Movie.Review.Comment"</p>
                        }
                        <small class="text-muted d-block mt-2">
                            @if (Movie.Review.UpdatedDate.HasValue)
                            {
                                <span>Updated: @Movie.Review.UpdatedDate.Value.ToString("MMM dd, yyyy")</span>
                            }
                            else
                            {
                                <span>Created: @Movie.Review.CreatedDate.ToString("MMM dd, yyyy")</span>
                            }
                        </small>
                    </article>
                }
            </section>
            
            <footer class="modal-footer">
                <button type="button" class="btn btn-primary" @onclick="() => OnEditReview.InvokeAsync(Movie)">
                    <i class="bi bi-star me-2"></i>@(Movie.Review != null ? "Edit Review" : "Add Review")
                </button>
                <button type="button" class="btn btn-secondary" @onclick="OnClose">Close</button>
            </footer>
        </header>
    </div>
</article>

@code {
    [Parameter]
    public WatchedMovie Movie { get; set; } = null!;

    [Parameter]
    public EventCallback OnClose { get; set; }

    [Parameter]
    public EventCallback<WatchedMovie> OnEditReview { get; set; }
}
